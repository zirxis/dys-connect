<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† - DYS-CONNECT Admin</title>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;500;600;700&family=Amiri:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="translations.js"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary-red': '#C41E3A',
                        'secondary-red': '#E85A4F',
                        'accent-orange': '#F28B30',
                        'warm-beige': '#F5F1E8',
                        'deep-brown': '#8B4513',
                        'soft-cream': '#FDF6E3',
                        'muted-gold': '#D4AF37',
                        'gentle-gray': '#6C757D'
                    },
                    fontFamily: {
                        'cairo': ['Cairo', 'sans-serif'],
                        'amiri': ['Amiri', 'serif']
                    }
                }
            }
        }
    </script>
    
    <style>
        body {
            font-family: 'Amiri', serif;
            background-color: #F5F1E8;
        }
        
        .logs-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .logs-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .logs-header h1 {
            font-size: 28px;
            font-weight: bold;
            color: #8B4513;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-family: 'Cairo', sans-serif;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #C41E3A 0%, #E85A4F 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(196, 30, 58, 0.3);
        }
        
        .btn-secondary {
            background-color: #E0E0E0;
            color: #333;
        }
        
        .btn-secondary:hover {
            background-color: #D0D0D0;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        
        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: #C41E3A;
            margin-bottom: 8px;
        }
        
        .stat-label {
            color: #6C757D;
            font-size: 14px;
        }
        
        .logs-table-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .logs-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .logs-table thead {
            background-color: #F5F1E8;
        }
        
        .logs-table th {
            padding: 15px;
            text-align: right;
            font-weight: 600;
            color: #8B4513;
            border-bottom: 2px solid #E85A4F;
        }
        
        .logs-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #E0E0E0;
        }
        
        .logs-table tr:hover {
            background-color: #F9F9F9;
        }
        
        .status-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .status-success {
            background-color: #d4edda;
            color: #155724;
        }
        
        .status-failed {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .no-logs {
            text-align: center;
            padding: 40px;
            color: #6C757D;
        }
        
        .filter-section {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .filter-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .filter-input {
            padding: 8px 12px;
            border: 2px solid #E0E0E0;
            border-radius: 8px;
            font-family: 'Amiri', serif;
        }
        
        .filter-input:focus {
            outline: none;
            border-color: #C41E3A;
        }
        
        /* Dark Mode */
        html.dark body {
            background-color: #1a1a1a;
        }
        
        html.dark .logs-container {
            background-color: #1a1a1a;
            color: #e0e0e0;
        }
        
        html.dark .stat-card {
            background-color: #2a2a2a;
        }
        
        html.dark .logs-table-container {
            background-color: #2a2a2a;
        }
        
        html.dark .logs-table thead {
            background-color: #3a3a3a;
        }
        
        html.dark .logs-table td {
            border-bottom-color: #444;
        }
        
        html.dark .logs-table tr:hover {
            background-color: #333;
        }
        
        html.dark .filter-section {
            background-color: #2a2a2a;
        }
    </style>
</head>
<body class="bg-warm-beige">
    <!-- Language & Theme Toggle -->
    <div style="position: fixed; top: 20px; left: 20px; z-index: 50; display: flex; gap: 10px;">
        <button class="btn btn-secondary" onclick="setLanguage('ar')">ğŸ‡©ğŸ‡¿ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</button>
        <button class="btn btn-secondary" onclick="setLanguage('fr')">ğŸ‡«ğŸ‡· FranÃ§ais</button>
        <button class="btn btn-secondary" onclick="toggleTheme()">ğŸŒ™</button>
    </div>

    <div class="logs-container">
        <!-- Header -->
        <div class="logs-header">
            <h1 data-translate="adminLogs">Ø³Ø¬Ù„Ø§Øª ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h1>
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="exportToCSV()">ğŸ“¥ ØªØ­Ù…ÙŠÙ„ ÙƒÙ€ CSV</button>
                <button class="btn btn-secondary" onclick="refreshLogs()">ğŸ”„ ØªØ­Ø¯ÙŠØ«</button>
                <button class="btn btn-secondary" onclick="clearAllLogs()" style="background-color: #f8d7da; color: #721c24;">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</button>
                <a href="index.html" class="btn btn-secondary">â† Ø§Ù„Ø¹ÙˆØ¯Ø©</a>
            </div>
        </div>

        <!-- Statistics -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="total-logins">0</div>
                <div class="stat-label" data-translate="totalLogins">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="successful-logins">0</div>
                <div class="stat-label" data-translate="successfulLogins">Ø¹Ù…Ù„ÙŠØ§Øª Ø¯Ø®ÙˆÙ„ Ù†Ø§Ø¬Ø­Ø©</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="failed-logins">0</div>
                <div class="stat-label" data-translate="failedLogins">Ø¹Ù…Ù„ÙŠØ§Øª Ø¯Ø®ÙˆÙ„ ÙØ§Ø´Ù„Ø©</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="unique-users">0</div>
                <div class="stat-label" data-translate="uniqueUsers">Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† ÙØ±ÙŠØ¯ÙˆÙ†</div>
            </div>
        </div>

        <!-- Filter Section -->
        <div class="filter-section">
            <div class="filter-group">
                <input type="text" id="search-input" class="filter-input" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ø³ØªØ®Ø¯Ù…..." data-translate="placeholder" onkeyup="filterLogs()">
                <select id="status-filter" class="filter-input" onchange="filterLogs()">
                    <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
                    <option value="success">Ù†Ø§Ø¬Ø­ ÙÙ‚Ø·</option>
                    <option value="failed">ÙØ§Ø´Ù„ ÙÙ‚Ø·</option>
                </select>
                <select id="role-filter" class="filter-input" onchange="filterLogs()">
                    <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¯ÙˆØ§Ø±</option>
                    <option value="mother">Ø£Ù…</option>
                    <option value="teacher">Ù…Ø¹Ù„Ù…</option>
                    <option value="specialist">Ù…Ø®ØªØµ</option>
                    <option value="researcher">Ø¨Ø§Ø­Ø«</option>
                    <option value="institution">Ù…Ø¤Ø³Ø³Ø©</option>
                </select>
            </div>
        </div>

        <!-- Logs Table -->
        <div class="logs-table-container">
            <table class="logs-table" id="logs-table">
                <thead>
                    <tr>
                        <th data-translate="username">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
                        <th data-translate="role">Ø§Ù„Ø¯ÙˆØ±</th>
                        <th data-translate="status">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                        <th data-translate="date">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                        <th data-translate="time">Ø§Ù„ÙˆÙ‚Øª</th>
                    </tr>
                </thead>
                <tbody id="logs-body">
                </tbody>
            </table>
            <div id="no-logs-message" class="no-logs" style="display: none;" data-translate="noLogs">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª</div>
        </div>
    </div>

    <!-- Translations -->
    <script>
        // Add missing translations
        translations.ar.adminLogs = 'Ø³Ø¬Ù„Ø§Øª ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†';
        translations.ar.totalLogins = 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„';
        translations.ar.successfulLogins = 'Ø¹Ù…Ù„ÙŠØ§Øª Ø¯Ø®ÙˆÙ„ Ù†Ø§Ø¬Ø­Ø©';
        translations.ar.failedLogins = 'Ø¹Ù…Ù„ÙŠØ§Øª Ø¯Ø®ÙˆÙ„ ÙØ§Ø´Ù„Ø©';
        translations.ar.uniqueUsers = 'Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† ÙØ±ÙŠØ¯ÙˆÙ†';
        translations.ar.username = 'Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…';
        translations.ar.status = 'Ø§Ù„Ø­Ø§Ù„Ø©';
        translations.ar.date = 'Ø§Ù„ØªØ§Ø±ÙŠØ®';
        translations.ar.time = 'Ø§Ù„ÙˆÙ‚Øª';
        translations.ar.successful = 'Ù†Ø§Ø¬Ø­';
        translations.ar.failed = 'ÙØ§Ø´Ù„';
        translations.ar.noLogs = 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª';
        
        translations.fr.adminLogs = 'Journaux de connexion des utilisateurs';
        translations.fr.totalLogins = 'Total des tentatives de connexion';
        translations.fr.successfulLogins = 'Connexions rÃ©ussies';
        translations.fr.failedLogins = 'Connexions Ã©chouÃ©es';
        translations.fr.uniqueUsers = 'Utilisateurs uniques';
        translations.fr.username = 'Nom d\'utilisateur';
        translations.fr.status = 'Ã‰tat';
        translations.fr.date = 'Date';
        translations.fr.time = 'Heure';
        translations.fr.successful = 'RÃ©ussi';
        translations.fr.failed = 'Ã‰chouÃ©';
        translations.fr.noLogs = 'Aucun journal';
    </script>

    <!-- Scripts -->
    <script src="auth.js"></script>
    <script>
        function loadLogs() {
            const logs = getLoginLogs();
            const tbody = document.getElementById('logs-body');
            const noLogsMsg = document.getElementById('no-logs-message');
            
            if (logs.length === 0) {
                tbody.innerHTML = '';
                noLogsMsg.style.display = 'block';
                updateStats(logs);
                return;
            }
            
            noLogsMsg.style.display = 'none';
            
            // ØªØ±ØªÙŠØ¨ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ù…Ù† Ø§Ù„Ø£Ø­Ø¯Ø« Ø¥Ù„Ù‰ Ø§Ù„Ø£Ù‚Ø¯Ù…
            const sortedLogs = logs.reverse();
            
            tbody.innerHTML = sortedLogs.map((log, index) => `
                <tr>
                    <td>${log.username}</td>
                    <td>${getRoleTranslation(log.role)}</td>
                    <td>
                        <span class="status-badge ${log.success ? 'status-success' : 'status-failed'}">
                            ${log.success ? 'âœ“ ' + getTranslation('successful') : 'âœ— ' + getTranslation('failed')}
                        </span>
                    </td>
                    <td>${log.date}</td>
                    <td>${log.time}</td>
                </tr>
            `).join('');
            
            updateStats(logs);
        }
        
        function getRoleTranslation(role) {
            const roleMap = {
                'mother': currentLanguage === 'ar' ? 'Ø£Ù…' : 'MÃ¨re',
                'teacher': currentLanguage === 'ar' ? 'Ù…Ø¹Ù„Ù…' : 'Enseignant',
                'specialist': currentLanguage === 'ar' ? 'Ù…Ø®ØªØµ' : 'SpÃ©cialiste',
                'researcher': currentLanguage === 'ar' ? 'Ø¨Ø§Ø­Ø«' : 'Chercheur',
                'institution': currentLanguage === 'ar' ? 'Ù…Ø¤Ø³Ø³Ø©' : 'Institution'
            };
            return roleMap[role] || role;
        }
        
        function updateStats(logs) {
            const successfulCount = logs.filter(l => l.success).length;
            const failedCount = logs.filter(l => !l.success).length;
            const uniqueUsers = new Set(logs.map(l => l.username)).size;
            
            document.getElementById('total-logins').textContent = logs.length;
            document.getElementById('successful-logins').textContent = successfulCount;
            document.getElementById('failed-logins').textContent = failedCount;
            document.getElementById('unique-users').textContent = uniqueUsers;
        }
        
        function filterLogs() {
            const logs = getLoginLogs();
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            const statusFilter = document.getElementById('status-filter').value;
            const roleFilter = document.getElementById('role-filter').value;
            
            const filtered = logs.filter(log => {
                const matchSearch = log.username.toLowerCase().includes(searchTerm);
                const matchStatus = !statusFilter || (statusFilter === 'success' ? log.success : !log.success);
                const matchRole = !roleFilter || log.role === roleFilter;
                
                return matchSearch && matchStatus && matchRole;
            });
            
            const tbody = document.getElementById('logs-body');
            const noLogsMsg = document.getElementById('no-logs-message');
            
            if (filtered.length === 0) {
                tbody.innerHTML = '';
                noLogsMsg.style.display = 'block';
                return;
            }
            
            noLogsMsg.style.display = 'none';
            tbody.innerHTML = filtered.reverse().map(log => `
                <tr>
                    <td>${log.username}</td>
                    <td>${getRoleTranslation(log.role)}</td>
                    <td>
                        <span class="status-badge ${log.success ? 'status-success' : 'status-failed'}">
                            ${log.success ? 'âœ“ ' + getTranslation('successful') : 'âœ— ' + getTranslation('failed')}
                        </span>
                    </td>
                    <td>${log.date}</td>
                    <td>${log.time}</td>
                </tr>
            `).join('');
        }
        
        function exportToCSV() {
            const logs = getLoginLogs();
            if (logs.length === 0) {
                alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª Ù„ØªØµØ¯ÙŠØ±Ù‡Ø§');
                return;
            }
            
            const headers = ['Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…', 'Ø§Ù„Ø¯ÙˆØ±', 'Ø§Ù„Ù†Ø¬Ø§Ø­', 'Ø§Ù„ØªØ§Ø±ÙŠØ®', 'Ø§Ù„ÙˆÙ‚Øª'];
            const rows = logs.map(log => [
                log.username,
                getRoleTranslation(log.role),
                log.success ? 'Ù†Ø¹Ù…' : 'Ù„Ø§',
                log.date,
                log.time
            ]);
            
            const csv = [headers, ...rows].map(row => row.join(',')).join('\n');
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `login-logs-${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
        }
        
        function clearAllLogs() {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø±ØºØ¨ØªÙƒ ÙÙŠ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ø¬Ù„Ø§ØªØŸ')) {
                clearLoginLogs();
                loadLogs();
            }
        }
        
        function refreshLogs() {
            loadLogs();
        }
        
        // Load logs on page load
        document.addEventListener('DOMContentLoaded', () => {
            updatePageLanguage();
            applyTheme();
            loadLogs();
        });
    </script>
</body>
</html>
